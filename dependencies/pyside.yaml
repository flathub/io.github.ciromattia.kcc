name: pyside
buildsystem: simple
build-options:
  env:
    LLVM_INSTALL_DIR: /usr/lib/sdk/llvm21
  append-path: /usr/lib/sdk/llvm21/bin
  prepend-ld-library-path: /usr/lib/sdk/llvm21/lib
build-commands:
  - python3 setup.py install --prefix $FLATPAK_DEST --limited-api=no --qtpaths=/usr/bin/qtpaths6
    --no-qt-tools --log-level=verbose

sources:
  - type: git
    url: https://github.com/qtproject/pyside-pyside-setup.git
    tag: v6.10.0

  - type: shell
    commands:
      - sed -i -e 's|PYSIDE_TREAT_QT_INCLUDE_DIRS_AS_NON_SYSTEM|1|g' sources/pyside6/cmake/Macros/PySideModules.cmake

modules:
  - name: patchelf
    buildsystem: autotools
    cleanup: ['*']
    sources:
      - type: git
        url: https://github.com/NixOS/patchelf.git
        tag: 0.18.0

  - name: python3-packaging
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "flit-core>=3.9.0" --no-build-isolation
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "packaging>=24.1" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/69/59/b6fc2188dfc7ea4f936cd12b49d707f66a1cb7a1d2c16172963534db741b/flit_core-3.12.0.tar.gz
        sha256: 18f63100d6f94385c6ed57a72073443e1a71a4acb4339491615d0f16d6ff01b2
        x-checker-data:
          type: pypi
          name: flit-core
      - type: file
        url: https://files.pythonhosted.org/packages/65/ee/299d360cdc32edc7d2cf530f3accf79c4fca01e96ffc950d8a52213bd8e4/packaging-26.0.tar.gz
        sha256: 00243ae351a257117b6a241061796684b084ed1c516a08c48a3f7e147a9d80b4
        x-checker-data:
          type: pypi
          name: packaging
